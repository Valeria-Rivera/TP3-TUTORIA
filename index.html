<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listado de Autos - Supabase</title>
    <!-- 
        COMENTARIO: Aquí es donde debes agregar las referencias a tus frameworks de diseño. 
        Por ejemplo, el CSS de Bootstrap o Tailwind.
        
        EJEMPLO PARA BOOTSTRAP (DESCOMENTAR CUANDO SE QUIERA APLICAR DISEÑO):
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    -->
    <style>
        /* COMENTARIO: Los estilos a continuación son mínimos y solo para asegurar la legibilidad básica. */
        body { font-family: sans-serif; padding: 20px; }
        .auto-item { 
            border: 1px solid #ccc; 
            margin-bottom: 10px; 
            padding: 10px; 
        }
        .auto-item p { margin: 5px 0; }
    </style>
</head>
<body>

    <!-- COMENTARIO: Este es el contenedor principal. Aquí puedes agregar tu Navbar y estructura de layout. -->
    <div id="app-container">
        
        <h1>Listado de Autos desde Supabase</h1>
        <p>A continuación se muestran los datos de la tabla "autos".</p>

        <!-- Contenedor para mensajes de estado (carga o error) -->
        <div id="status-message" style="color: blue; margin-bottom: 15px;">
            Cargando datos...
        </div>

        <!-- Lista donde se insertarán los elementos de la base de datos -->
        <div id="auto-list">
            <!-- COMENTARIO: Los elementos de los autos (<div> o <li>) se insertarán aquí. -->
        </div>
        
    </div>

    <!-- 
        COMENTARIO: Aquí se cargan las dependencias del Script. 
        1. Librería Supabase.
        2. Script de Bootstrap (si se usa).
    -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- EJEMPLO PARA BOOTSTRAP JS (DESCOMENTAR CUANDO SE QUIERA APLICAR DISEÑO): 
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    -->

    <script>
        // COMENTARIO: Inicia el Script de JavaScript.
        
        // 1. Datos de conexión proporcionados
        const SUPABASE_URL = 'https://ehevikaoxwajkbnidxoo.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVoZXZpa2FveHdhamtibmlkeG9vIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjExNTY1ODgsImV4cCI6MjA3NjczMjU4OH0.gc-fSzt1uqkpi7V-Ts4_BRkwMedvTdLwkS0Nl0VtREs';
        const TABLE_NAME = 'autos';
        
        // Elementos del DOM
        const statusMessage = document.getElementById('status-message');
        const autoList = document.getElementById('auto-list');

        // 2. Inicialización del cliente Supabase
        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);

        /**
         * Función para mostrar un error en el contenedor de mensajes.
         * @param {string} msg - El mensaje de error a mostrar.
         */
        function displayError(msg) {
            statusMessage.style.color = 'red';
            statusMessage.textContent = 'ERROR: ' + msg;
            console.error('Supabase Error:', msg);
        }

        /**
         * Función para mostrar un registro de auto en el DOM.
         * @param {object} auto - El objeto con los datos del auto.
         */
        function displayAuto(auto) {
            // Crea un contenedor <div> para cada auto
            const autoDiv = document.createElement('div');
            autoDiv.className = 'auto-item'; // Clase básica para el contenedor (usarás clases Bootstrap aquí)
            
            // Recorre todas las propiedades del objeto auto (columnas de la tabla)
            for (const key in auto) {
                if (auto.hasOwnProperty(key)) {
                    const label = key.charAt(0).toUpperCase() + key.slice(1); // Capitaliza la primera letra para la etiqueta
                    const value = auto[key];
                    
                    // Crea un párrafo (o etiqueta similar) para cada campo
                    const p = document.createElement('p');
                    p.innerHTML = `<strong>${label}:</strong> ${value}`;
                    
                    autoDiv.appendChild(p);
                }
            }
            
            // Línea separadora simple
            const hr = document.createElement('hr');
            autoDiv.appendChild(hr);

            // Agrega el contenedor del auto a la lista principal
            autoList.appendChild(autoDiv);
        }

        /**
         * Función principal para consultar y listar los datos de la tabla.
         */
        async function fetchAutos() {
            // 3. Consultar todos los datos de la tabla 'autos'
            const { data, error } = await supabaseClient
                .from(TABLE_NAME)
                .select('*'); // '*' selecciona todas las columnas

            if (error) {
                // 8. Manejo de errores
                displayError(`No se pudo cargar la tabla ${TABLE_NAME}. Mensaje: ${error.message}`);
                return;
            }

            // Si la consulta es exitosa:
            
            // Limpia el mensaje de estado y muestra el total de registros
            statusMessage.style.color = 'green';
            statusMessage.textContent = `Éxito al cargar ${data.length} registros de autos.`;

            if (data.length === 0) {
                statusMessage.textContent += " La tabla está vacía.";
            }

            // 4. Iterar sobre los resultados
            data.forEach(auto => {
                // 5. Crear y mostrar elementos HTML
                displayAuto(auto);
            });
        }

        // Ejecutar la función de consulta al cargar la página
        window.onload = fetchAutos;

    </script>
</body>
</html>