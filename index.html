<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listado de Autos - Supabase (Bootstrap)</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <style>
        /* Estilos personalizados para mantener la separaci√≥n, usando rem como unidad */
        body { 
            background-color: #f8f9fa; /* Fondo gris claro de Bootstrap */
        }
        .auto-card { 
            margin-bottom: 1.5rem; /* Margen inferior para separar las tarjetas */
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-car-front-fill me-2" viewBox="0 0 16 16">
                    <path d="M2.52 3.522A.5.5 0 0 1 3 3.5v9a.5.5 0 0 1-.52.478L.5 12.18l.745-1.996a.5.5 0 0 1 .432-.284h11.646a.5.5 0 0 1 .432.284l.745 1.996.02-.008a.5.5 0 0 1-.52-.478v-9a.5.5 0 0 1 .52-.478l1.62-.36a.25.25 0 0 1 .189.043l.745 1.996a.5.5 0 0 1 .432.284h.079a.5.5 0 0 1 .52.478v.5a.5.5 0 0 1-.5.5H.5a.5.5 0 0 1-.5-.5v-.5a.5.5 0 0 1 .52-.478l1.62-.36a.25.25 0 0 1 .189.043z"/>
                    <path d="M4 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm10 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zM1 3a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm14 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/>
                </svg>
                Cat√°logo Supabase
            </a>
            <button id="add-new-btn" class="btn btn-warning btn-sm" onclick="alert('Funcionalidad de Agregar Nuevo Auto pendiente!')">
                <i class="bi bi-plus-lg"></i> ‚ûï Agregar Nuevo Auto
            </button>
        </div>
    </nav>
    
    <div class="container mt-4">
        <div id="app-container">
            
            <h1 class="mb-3 text-primary">Listado de Autos üöÄ</h1>
            <p class="lead">Datos de la tabla **"autos"** cargados desde Supabase.</p>

            <div id="status-message" class="alert alert-info" role="alert">
                Cargando datos...
            </div>
            
            <div class="mb-4">
                <button class="btn btn-outline-success me-2" onclick="alert('Bot√≥n de filtrado simulado')">üîç Aplicar Filtros</button>
                <button class="btn btn-secondary" onclick="window.location.reload()">üîÑ Recargar Lista</button>
            </div>

            <div id="auto-list" class="row">
                </div>
            
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        // COMENTARIO: Inicia el Script de JavaScript.
        
        // 1. Datos de conexi√≥n proporcionados
        const SUPABASE_URL = 'https://ehevikaoxwajkbnidxoo.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVoZXZpa2FveHdhamtibmlkeG9vIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjExNTY1ODgsImV4cCI6MjA3NjczMjU4OH0.gc-fSzt1uqkpi7V-Ts4_BRkwMedvTdLwkS0Nl0VtREs';
        const TABLE_NAME = 'autos';
        
        // Elementos del DOM
        const statusMessage = document.getElementById('status-message');
        const autoList = document.getElementById('auto-list');

        // 2. Inicializaci√≥n del cliente Supabase
        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);

        /**
         * Funci√≥n para mostrar un error en el contenedor de mensajes (usando clase de Bootstrap).
         * @param {string} msg - El mensaje de error a mostrar.
         */
        function displayError(msg) {
            statusMessage.classList.remove('alert-info');
            statusMessage.classList.add('alert-danger'); // Clase para errores en Bootstrap
            statusMessage.textContent = '‚ùå ERROR: ' + msg;
            console.error('Supabase Error:', msg);
        }

        /**
         * Funci√≥n para mostrar un registro de auto como una Card de Bootstrap.
         * @param {object} auto - El objeto con los datos del auto.
         */
        function displayAuto(auto) {
            // Crea una columna (col-md-4) para el layout en grid de Bootstrap
            const colDiv = document.createElement('div');
            colDiv.className = 'col-md-4 col-lg-3 auto-card'; // 4 columnas en desktop, 3 en pantallas grandes
            
            // Crea una tarjeta (Card) de Bootstrap
            const autoCard = document.createElement('div');
            autoCard.className = 'card shadow h-100'; // Sombra y altura uniforme

            const cardBody = document.createElement('div');
            cardBody.className = 'card-body';

            // T√≠tulo de la tarjeta (Idealmente con una columna importante como "Modelo" o "Marca")
            const cardTitle = document.createElement('h5');
            cardTitle.className = 'card-title text-primary';
            // Suponiendo que hay una columna 'modelo' o simplemente muestra el ID
            cardTitle.textContent = auto.hasOwnProperty('modelo') ? auto.modelo : `Auto ID: ${auto.id}`;

            const cardText = document.createElement('ul');
            cardText.className = 'list-group list-group-flush'; // Lista sin bordes ni padding

            // Recorre todas las propiedades del objeto auto (columnas de la tabla)
            for (const key in auto) {
                if (auto.hasOwnProperty(key)) {
                    // Evitar mostrar el campo 'id' dos veces o datos de sistema si no es necesario
                    if (key === 'id') continue; 
                    
                    const label = key.charAt(0).toUpperCase() + key.slice(1); // Capitaliza la primera letra
                    const value = auto[key];
                    
                    // Crea un elemento de lista para cada campo
                    const li = document.createElement('li');
                    li.className = 'list-group-item d-flex justify-content-between align-items-center';
                    li.innerHTML = `<strong>${label}</strong> <span>${value}</span>`;
                    
                    cardText.appendChild(li);
                }
            }
            
            // Agrega botones de acci√≥n
            const cardFooter = document.createElement('div');
            cardFooter.className = 'card-footer bg-light d-flex justify-content-between';
            
            const editBtn = document.createElement('button');
            editBtn.className = 'btn btn-sm btn-outline-info';
            editBtn.textContent = '‚úèÔ∏è Editar';
            editBtn.onclick = () => alert(`Editar Auto ID: ${auto.id}`);
            
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'btn btn-sm btn-outline-danger';
            deleteBtn.textContent = 'üóëÔ∏è Eliminar';
            deleteBtn.onclick = () => alert(`Eliminar Auto ID: ${auto.id}`);
            
            cardFooter.appendChild(editBtn);
            cardFooter.appendChild(deleteBtn);


            // Ensambla la tarjeta
            cardBody.appendChild(cardTitle);
            cardBody.appendChild(cardText);
            autoCard.appendChild(cardBody);
            autoCard.appendChild(cardFooter);
            colDiv.appendChild(autoCard);

            // Agrega la columna (con la tarjeta) a la lista principal
            autoList.appendChild(colDiv);
        }

        /**
         * Funci√≥n principal para consultar y listar los datos de la tabla.
         */
        async function fetchAutos() {
            // 3. Consultar todos los datos de la tabla 'autos'
            const { data, error } = await supabaseClient
                .from(TABLE_NAME)
                .select('*')
                .order('id', { ascending: true }); // Ordena por ID

            if (error) {
                // 8. Manejo de errores
                displayError(`No se pudo cargar la tabla ${TABLE_NAME}. Mensaje: ${error.message}`);
                return;
            }

            // Si la consulta es exitosa:
            
            // Actualiza el mensaje de estado (Bootstrap success)
            statusMessage.classList.remove('alert-info');
            statusMessage.classList.add('alert-success');
            statusMessage.textContent = `‚úÖ √âxito al cargar ${data.length} registros de autos.`;

            if (data.length === 0) {
                statusMessage.textContent += " La tabla est√° vac√≠a.";
            }

            // 4. Iterar sobre los resultados
            // 5. Crear y mostrar elementos HTML (Cards de Bootstrap)
            data.forEach(auto => {
                displayAuto(auto);
            });
        }

        // Ejecutar la funci√≥n de consulta al cargar la p√°gina
        window.onload = fetchAutos;

    </script>
</body>
</html>